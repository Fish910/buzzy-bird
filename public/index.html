<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Pitch Bird</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css?family=Comic+Neue:400,700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <!-- Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <!-- Inline Firebase config to avoid serving issues -->
  <script>
    console.log("Loading Firebase configuration inline...");
    window.firebaseConfig = {
      apiKey: "AIzaSyDh-UejLP_DLWWuWDwUM0PeOSG6IYqBO0U",
      authDomain: "pitch-bird.firebaseapp.com",
      projectId: "pitch-bird",
      storageBucket: "pitch-bird.firebasestorage.app",
      messagingSenderId: "356300745950",
      appId: "1:356300745950:web:bef4de640276fac4c8264f",
      measurementId: "G-8SS9R2QGRW"
    };
    console.log("Firebase configuration loaded:", window.firebaseConfig);
  </script>
</head>
<body>
  <div id="mainMenu" class="menu">
    <!-- Leaderboard replaces splash image -->
    <div id="leaderboardContainer" class="leaderboard-container">
      <div class="leaderboard-header">
        <h2>Leaderboard</h2>
        <button id="changeNameBtn" class="top-right-btn hidden">Change Name</button>
      </div>
      <div id="leaderboardList" class="leaderboard-list">
        <!-- Leaderboard entries will be rendered here -->
      </div>
      <div class="leaderboard-footer">
        <button id="signUpBtn" class="bottom-right-btn">Sign Up</button>
        <button id="logInBtn" class="bottom-right-btn">Log In</button>
      </div>
    </div>
    <div class="menu-buttons">
      <div class="main-menu-btns">
        <button id="skinsBtn">Cosmetics</button>
        <button id="settingsBtn">Settings</button>
        <button id="howToBtn">How to Play</button>
        <button id="creditsBtn">Credits</button>
      </div>
      <div style="display: flex; flex-direction: row; gap: 12px; margin-top: 0;">
        <button id="bugBtn">Report a Bug</button>
        <button id="difficultyBtn">Normal</button>
      </div>
    </div>
    <div class="menu-info">
      <span id="pointsDisplay">Points: 0</span>
      <span id="highScoreDisplay">High Score: 0</span>
    </div>
    <div style="position: absolute; left: 12px; right: 0; bottom: 8px; width: 100%; text-align: left; color: #ffffff; font-size: 0.8em; pointer-events: none; max-width: 480px; margin: 0 auto;">
         Pitch Bird v5.2.0
    </div>
  </div>

  <!-- Sign Up Modal -->
  <div id="signUpModal" class="popup hidden">
    <div class="popup-content">
      <h2>Sign Up</h2>
      <label for="signUpName">Name (max 20 chars):</label>
      <input type="text" id="signUpName" maxlength="20" autocomplete="off">
      <label for="signUpPasscode">4-digit Passcode:</label>
      <input type="password" id="signUpPasscode" maxlength="4" pattern="\d{4}" inputmode="numeric" autocomplete="off">
      <button id="signUpSubmitBtn">Create Account</button>
      <button id="signUpCancelBtn">Cancel</button>
      <div id="signUpError" class="error-msg"></div>
    </div>
  </div>

  <!-- Log In Modal -->
  <div id="logInModal" class="popup hidden">
    <div class="popup-content">
      <h2>Log In</h2>
      <label for="logInName">Name:</label>
      <input type="text" id="logInName" maxlength="20" autocomplete="off">
      <label for="logInPasscode">4-digit Passcode:</label>
      <input type="password" id="logInPasscode" maxlength="4" pattern="\d{4}" inputmode="numeric" autocomplete="off">
      <button id="logInSubmitBtn">Log In</button>
      <button id="logInCancelBtn">Cancel</button>
      <div id="logInError" class="error-msg"></div>
    </div>
  </div>

  <!-- Change Name Modal -->
  <div id="changeNameModal" class="popup hidden">
    <div class="popup-content">
      <h2>Change Name</h2>
      <label for="changeNameNew">New Name (max 20 chars):</label>
      <input type="text" id="changeNameNew" maxlength="20" autocomplete="off">
      <label for="changeNamePasscode">Your 4-digit Passcode:</label>
      <input type="password" id="changeNamePasscode" maxlength="4" pattern="\d{4}" inputmode="numeric" autocomplete="off">
      <button id="changeNameSubmitBtn">Change Name</button>
      <button id="changeNameCancelBtn">Cancel</button>
      <div id="changeNameError" class="error-msg"></div>
    </div>
  </div>

  <!-- Existing popups and canvas/game elements below -->
  <div id="skinsPopup" class="popup hidden">
    <div class="popup-content cosmetics-popup">
      <button class="popup-close-x" id="closeSkinsBtn">×</button>
      <div class="cosmetics-tabs">
        <button id="birdsTab" class="cosmetics-tab active">Birds</button>
        <button id="pipesTab" class="cosmetics-tab">Pipes</button>
        <button id="backdropsTab" class="cosmetics-tab">Backdrops</button>
      </div>
      <div id="cosmeticsGrid" class="cosmetics-grid"></div>
    </div>
  </div>

  <div id="howToPopup" class="popup hidden">
    <div class="popup-content">
      <button class="popup-close-x" id="closeHowToBtn">×</button>
      <h2>How to Play</h2>
      <div id="howToText" style="max-width: 340px; text-align: left;">
        <p>Use your voice or instrument to control the bird's height! The higher the pitch, the higher the bird flies. Avoid the pipes and try to get the highest score possible. Pause by tapping/clicking the screen. To start the game, tap anywhere.</p>
        <p></p>
        <p>Click on settings to choose the pitch range that the game will be played in and determine how often you get breaks!</p>
        <p></p>
        <p>More skins coming soon!</p>
      </div>
    </div>
  </div>

  <div id="creditsPopup" class="popup hidden">
    <div class="popup-content">
      <button class="popup-close-x" id="closeCreditsBtn">×</button>
      <h2>Credits</h2>
      <div id="creditsText" style="max-width: 340px; text-align: left; line-height: 30px;">
        <p>Game by Liam Downing.<br>
        - Powered by ml5.js and the Web Audio API.<br>
        - Uses Firebase for backend storage.<br>
        - Special thanks to Brynn Di Anni and Tyler Caralho for bug testing and feedback.<br>
      </p>
      </div>
    </div>
  </div>

  <div id="settingsPopup" class="popup hidden">
    <div class="popup-content cosmetics-popup">
      <button class="popup-close-x" id="closeSettingsBtn">×</button>
      <div class="cosmetics-tabs">
        <button class="cosmetics-tab active" id="pitchRangeTab">Pitch Range</button>
        <button class="cosmetics-tab" id="advancedTab">Advanced Difficulty</button>
      </div>
      <div id="settingsContent" style="margin-top: 20px;">
        <div id="pitchRangeContent" class="settings-tab-content">
          <div style="display: flex; flex-direction: column; gap: 18px; align-items: center;">
            <div class="setting-row">
              <label for="topNoteBox">Top Note:</label>
              <div id="topNoteBox" class="note-box">C4</div>
            </div>
            <div class="setting-row">
              <label for="bottomNoteBox">Bottom Note:</label>
              <div id="bottomNoteBox" class="note-box">C3</div>
            </div>
          </div>
        </div>
        <div id="advancedContent" class="settings-tab-content hidden">
          <div style="display: flex; flex-direction: column; gap: 18px; align-items: center;">
            <div class="setting-row">
              <label for="pipesPerBreakBox">Pipes per break:</label>
              <div id="pipesPerBreakBox" class="note-box">5</div>
            </div>
            <div class="setting-row">
              <label for="pipeSpeedBox">Pipe speed:</label>
              <div id="pipeSpeedBox" class="note-box">50</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="noteSliderPopup" class="popup hidden">
    <div class="popup-content">
      <h3 id="sliderLabel">Select Note</h3>
      <input type="range" id="noteSlider" min="0" max="71" value="36" style="width: 220px;">
      <div id="sliderNoteDisplay" style="margin-top: 12px; font-size: 1.2em;">C3</div>
      <button id="closeNoteSliderBtn">OK</button>
    </div>
  </div>
  <canvas id="gameCanvas"></canvas>
  <div id="loadingOverlay" class="loading-overlay"></div>
  <script src="storage.js"></script>
  <script src="cosmetics.js"></script>
  <script src="game.js"></script>
  <script src="menu.js"></script>
  <script src="script.js"></script>
</body>
</html>
